<!DOCTYPE hibernate-mapping 
    PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
    
    <!-- 
    changes for 2014:
    
    alter table approval_surveys drop column sharingWith;
    alter table approval_surveys drop column livingIn;
	alter table approval_surveys drop column livingInOther;
	alter table approval_surveys drop column livingSpaceSize;
	
	alter table registration_forms add column `sharingWith` longtext;
	alter table registration_forms add column `livingIn` varchar(255) DEFAULT NULL;
	alter table registration_forms add column `livingInOther` varchar(255) DEFAULT NULL;
	alter table registration_forms add column `livingSpaceSize` longtext;
	
	7/29/2015
	drop admincomment from user
	add leaveComments to roles
	add viewComments to roles
	
	CREATE TABLE IF NOT EXISTS `comments` (
  `commentId` bigint(20) NOT NULL,
  `author` bigint(20) NOT NULL,
  `subject` bigint(20) NOT NULL,
  `time` bigint(20) NOT NULL,
  `comment` text NOT NULL,
  `index` int(11) DEFAULT NULL,
  PRIMARY KEY (`commentId`),
  KEY `subject` (`subject`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

   2016:
   DB changes to make:
  - profile location 5 ("New England") replace as other + text
  - profile location other + "Austin" replace with 9
  - drop groupLeaderId
  - drop mealPreference
  - delete from cells
  - delete from user_cells
  - rebuild cells from csv
   
	    
     -->
    
<hibernate-mapping default-access="field">
<!-- 
    <class name="d13.notify.BackgroundNotificationManager$RateLimiter$Entry" table="notification_quota_track">
        <id name="entryId"><generator class="native"/></id>
        <property name="entryTime" not-null="true" type="d13.dao.types.DateTimeType"/>
    </class>
-->
    <class name="d13.dao.RawIPNLogEntry" table="ipn_log">
        <id name="entryId"><generator class="native"/></id>
        <property name="received" type="d13.dao.types.DateTimeType" not-null="true"/>
        <property name="data" type="text"/>
        <property name="reply" type="string"/>
    </class>

    <class name="d13.dao.Invoice" table="invoices">
        <id name="invoiceId"><generator class="native"/></id>
        <list name="items" cascade="all">
            <key column="invoice"/>
            <index column="invoiceIndex"/>
            <one-to-many class="d13.dao.InvoiceItem"/>
        </list>
        <property name="status" not-null="true"/>
        <many-to-one name="creator" class="d13.dao.User" not-null="true"/>
        <property name="created" type="d13.dao.types.DateTimeType" not-null="true"/>
        <property name="invoiceAmount" not-null="true"/>
        <property name="paypalTransactionId" type="string"/>
        <property name="paypalSenderEmail" type="string"/>
        <property name="paypalSenderFirstName" type="string"/>
        <property name="paypalSenderLastName" type="string"/>
        <property name="paypalTransactionStatus" type="string"/>
        <property name="paypalTimestamp" type="string"/>
        <property name="paypalAmount" not-null="true"/>
        <property name="paypalFee" not-null="true"/>
    </class>
    
    <class name="d13.dao.InvoiceItem" table="invoice_items">
        <id name="invoiceItemId"><generator class="native"/></id>
        <many-to-one name="invoice" class="d13.dao.Invoice" not-null="true"/>
        <many-to-one name="due" class="d13.dao.DueItem" not-null="true"/>
        <property name="amount" not-null="true"/>
        <property name="description" type="string"/>
    </class>

    <class name="d13.dao.DueItem" table="dues_owed">
        <id name="itemId"><generator class="native"/></id>
        <many-to-one name="user" class="d13.dao.User"/>
        <property name="active" not-null="true"/>
        <property name="open" not-null="true"/>
        <many-to-one name="paidInvoice" class="d13.dao.Invoice"/>
        <property name="customAmount" not-null="true"/>
    </class>

    <class name="d13.dao.Role" table="roles">
        <id name="roleId"><generator class="native"/></id>
        <property name="name" not-null="true"/>
        <property name="level" not-null="true"/>
        <property name="viewUsers" not-null="true"/>
        <property name="editUsers" not-null="true"/>
        <property name="reviewUsers" not-null="true"/>
        <property name="admitUsers" not-null="true"/>
        <property name="finalizeUsers" not-null="true"/>
        <property name="viewLogs" not-null="true"/>
        <property name="editDues" not-null="true"/>
        <property name="maintenanceLogin" not-null="true"/>
        <property name="viewFullCells" not-null="true"/>
        <property name="inviteUsers" not-null="true"/>
        <property name="alwaysInvited" not-null="true"/>
        <property name="viewInvites" not-null="true"/>
        <property name="leaveComments" not-null="true"/>
        <property name="viewComments" not-null="true"/>
    </class>

    <class name="d13.dao.RuntimeOptions$RuntimeOption" table="options">
        <id name="name"><generator class="assigned"/></id>
        <property name="value"/>
    </class>

    <class name="d13.dao.QueuedEmail" table="notifications">
        <id name="qnId"><generator class="native"/></id>
        <property name="type" not-null="true"/>
        <property name="queued" not-null="true" type="d13.dao.types.DateTimeType"/>
        <property name="userId"/>
        <property name="inviteId"/>
        <property name="failedAttempt" type="d13.dao.types.DateTimeType"/>
        <property name="failedDetail" type="text"/>
    </class>

    <class name="d13.dao.ApprovalSurvey" table="approval_surveys">
        <id name="aformId"><generator class="foreign"><param name="property">user</param></generator></id>
        <one-to-one name="user" class="d13.dao.User" constrained="true"/>
        <property name="completionTime" type="d13.dao.types.DateTimeType"/>
        <property name="placementRequest" type="text"/>
        <property name="disengageSun" not-null="true"/>
        <property name="disengageMon" not-null="true"/>
        <property name="disengageTue" not-null="true"/>
        <property name="disengageWed" not-null="true"/>
        <property name="disengageNone" not-null="true"/>
    </class>
    
    <class name="d13.dao.RegistrationForm" table="registration_forms">
        <id name="rformId"><generator class="foreign"><param name="property">user</param></generator></id>
        <one-to-one name="user" class="d13.dao.User" constrained="true"/>
        <property name="completionTime" type="d13.dao.types.DateTimeType"/>
		<property name="helpedOffPlaya" type="text"/>
		<property name="helpedAlphaCamp"/>
		<property name="helpedCampBuild"/>
		<property name="helpedDisengage"/>
		<property name="helpedLeadRoles"/>
		<property name="helpedLoveMinistry"/>
		<property name="helpedLNT"/>
		<property name="helpedOther"/>
		<property name="helpedOtherOther" type="text"/>
		<property name="disorientVirgin"/>
		<property name="bmVirgin"/>
		<property name="sponsor" type="text"/>
		<property name="sponsorFor" type="text"/>
		<property name="arrivalDate"/>
		<property name="departureDate"/>
		<property name="departureTime"/>
		<property name="drivingFromTo" type="d13.dao.types.LocationType"/>
		<property name="drivingFromToOther" type="text"/>
		<property name="rvType" type="d13.dao.types.RVSelectionType"/>
        <property name="sharingWith" type="text"/>
        <property name="livingIn" type="string"/>
        <property name="livingInOther" type="string"/>
        <property name="livingSpaceSize" type="text"/>
		<property name="driving"/>
		<property name="rideSpaceTo"/>
		<property name="rideSpaceFrom"/>
		<property name="parkAtCamp"/>
		<property name="vehicleComments" type="text"/>
		<property name="needRideTo"/>
		<property name="needRideFrom"/>
		<property name="tixForSale" not-null="true"/>
		<property name="numForSale" not-null="true"/>
		<property name="tixWanted" not-null="true"/>
		<property name="numWanted" not-null="true"/>
		<property name="personalProject" type="text"/>
		<property name="comments" type="text"/>
        <property name="haveVehiclePass" not-null="true"/>
        <property name="tixSource" not-null="true" type="d13.dao.types.TicketSourceType"/>
    </class>
    
    <class name="d13.dao.ActivityLogEntry" table="activity_log">
        <id name="entryId"><generator class="native"/></id>
        <property name="time" not-null="true" type="d13.dao.types.DateTimeType"/>
        <many-to-one name="toWho" class="d13.dao.User" not-null="true"/>
        <many-to-one name="byWho" class="d13.dao.User"/>
        <property name="description"/>
    </class>
    
    <class name="d13.dao.Comment" table="comments">
        <id name="commentId"><generator class="native"/></id>
        <many-to-one name="author" class="d13.dao.User" not-null="true"/>
        <many-to-one name="subject" class="d13.dao.User" not-null="true"/>
        <property name="time" not-null="true" type="d13.dao.types.DateTimeType"/>
        <property name="comment" not-null="true"/>
    </class>

    <class name="d13.dao.Invite" table="invites">
        <id name="inviteId"><generator class="native"/></id>
        <property name="inviteCode" length="8" not-null="true" unique="true"/>
        <property name="inviteeEmail" length="254" not-null="true"/>
        <property name="inviteeName" length="128"/>
        <many-to-one name="createdBy" class="d13.dao.User" not-null="true"/>
        <property name="createdOn" type="d13.dao.types.DateTimeType" not-null="true"/>
        <many-to-one name="cancelledBy" class="d13.dao.User"/>
        <property name="cancelledOn" type="d13.dao.types.DateTimeType"/>
        <property name="expiresOn" type="d13.dao.types.DateTimeType"/>
        <property name="resolvedOn" type="d13.dao.types.DateTimeType"/>
        <many-to-one name="resolvedBy" class="d13.dao.User"/>
        <property name="status" not-null="true"/>
        <property name="comment" type="text"/>
    </class>
    
    <class name="d13.dao.User" table="users">
        <id name="userId"><generator class="native"/></id>
        <property name="email" length="254" not-null="true" unique="true"/>
        <many-to-one name="role" class="d13.dao.Role"/>
        <property name="passwordSalt" length="8" not-null="true"/>
        <property name="passwordHash" length="40" not-null="true"/>
        <property name="created" type="d13.dao.types.DateTimeType" not-null="true"/>
        <property name="lastLogin" type="d13.dao.types.DateTimeType"/>
        <property name="passwordResetKey" length="16"/>
        <property name="passwordResetTime" type="d13.dao.types.DateTimeType"/>
        <property name="termsAgreed" not-null="true"/>
        <many-to-one name="currentInvite" class="d13.dao.Invite" cascade="save-update"/>
        <property name="gender" type="d13.dao.types.GenderType" not-null="true"/>
        <property name="realName" length="128" not-null="true"/>
        <property name="playaName" length="128"/>
        <property name="location" type="d13.dao.types.LocationType" not-null="true"/>
        <property name="locationOther" length="128"/>
        <property name="phone" length="24"/>
        <property name="emergencyContact" type="text" not-null="true"/>
        <one-to-one name="registration" class="d13.dao.RegistrationForm" cascade="save-update"/>
        <one-to-one name="approval" class="d13.dao.ApprovalSurvey" cascade="save-update"/>
        <property name="state" type="d13.dao.types.UserStateType" not-null="true"/>
        <property name="approvedOn" type="d13.dao.types.DateTimeType"/>
        <property name="gracePeriodStart" type="d13.dao.types.DateTimeType"/>
        <set name="cells" table="users_cells">
            <key column="userId"/>
            <many-to-many column="cellId" class="d13.dao.Cell"/>
        </set>
        <list name="activityLog" cascade="all">
            <key column="toWho"/>
            <index column="`index`"/>
            <one-to-many class="d13.dao.ActivityLogEntry"/>
        </list>
        <many-to-one name="personalDue" class="d13.dao.DueItem" cascade="all"/>
        <many-to-one name="rvDue" class="d13.dao.DueItem" cascade="all"/>
        <property name="customDueComments" type="text"/>
        <list name="invoices" inverse="true">
            <key column="creator"/>
            <index column="creatorIndex"/>
            <one-to-many class="d13.dao.Invoice"/>
        </list>
        <property name="receiveNotifications" not-null="true"/>
        <list name="comments" cascade="all">
            <key column="subject"/>
            <index column="`index`"/>
            <one-to-many class="d13.dao.Comment"/>
        </list>
    </class>
    
    <class name="d13.dao.Cell" table="cells">
        <id name="cellId"><generator class="native"/></id>
        <many-to-one name="parent" class="d13.dao.Cell" insert="false" update="false"/>
        <property name="category" not-null="true"/>
        <property name="hideWhenFull" not-null="true"/>
        <property name="name" type="string" length="128" not-null="true"/>
        <property name="description" type="text"/>
        <property name="people" not-null="true"/>
        <property name="startDate"/>
        <property name="endDate"/>
        <set name="users" inverse="true" table="users_cells">
            <key column="cellId"/>
            <many-to-many column="userId" class="d13.dao.User"/>
        </set>
        <list name="children" cascade="all">
            <key column="parent"/>
            <index column="`index`"/>
            <one-to-many class="d13.dao.Cell"/>
        </list>
    </class>

</hibernate-mapping>
